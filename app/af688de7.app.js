"use strict";angular.module("fullstackApp",["ionic","jett.ionic.filter.bar","ionicScroller"]).constant("HOST","http://http://mean.oschina.mopaasapp.com").config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$locationProvider","$httpProvider","$ionicFilterBarConfigProvider",function(a,b,c,d,e,f){c.platform.ios.tabs.style("standard"),c.platform.ios.tabs.position("bottom"),c.platform.android.tabs.style("standard"),c.platform.android.tabs.position("bottom"),c.platform.ios.navBar.alignTitle("center"),c.platform.android.navBar.alignTitle("center"),c.platform.ios.backButton.text("返回").previousTitleText(!1).icon("ion-ios-arrow-left"),c.platform.android.backButton.text("返回").previousTitleText(!1).icon("ion-android-arrow-back"),c.platform.ios.views.transition("ios"),c.platform.android.views.transition("android"),delete e.defaults.headers.common["X-Requested-With"],e.defaults.headers.common.Accept="application/api.fullstackApp.v1+json",e.defaults.useXDomain=!0,f.theme("assertive"),f.backdrop(!1),f.placeholder("搜索"),b.otherwise("/"),d.html5Mode(!0)}]),angular.module("fullstackApp").controller("AlarmCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("fullstackApp").config(["$stateProvider",function(a){a.state("tabs.alarm",{url:"/alarm",views:{"tabs-alarm":{templateUrl:"app/alarm/alarm.html",controller:"AlarmCtrl"}}})}]),angular.module("fullstackApp").directive("addAnimates",function(){return{restrict:"A",link:function(a,b){b.on("tap",function(){b.parent().parent().css({height:0,"min-height":0})})}}}),angular.module("fullstackApp").directive("errSrc",function(){return{restrict:"A",link:function(a,b,c){b.bind("error",function(){c.src!=c.errSrc&&c.$set("src",c.errSrc)})}}}),angular.module("fullstackApp").directive("hideTabs",["$rootScope",function(a){return{restrict:"A",link:function(b,c){a.hideTabs=!0,b.$on("$destroy",function(){a.hideTabs=!1})}}}]),angular.module("fullstackApp").directive("mClear",function(){return{restrict:"A",replace:!0,link:function(a,b,c){var d=b.find("input"),e=b.find("i");b.find("span").css("visibility","hidden"),b.find("span").on("touchstart",function(){d.val("")}),d.on("focus",function(){e.addClass("active"),b.find("span").css("visibility","inherit")}),d.on("blur",function(){""===d.val()?(e.removeClass("active"),b.find("span").css("visibility","hidden")):b.find("span").css("visibility","inherit")})}}}).directive("clearIcon",function(){return{restrict:"E",replace:!0,template:'<span class="icon ion-ios-close placeholder-icon" style="left:auto; right:5px;"></span>'}}),angular.module("fullstackApp").controller("ItemCtrl",["$scope",function(a){var b,c;a.onTouch=function(a){b=a.target.offsetLeft,c=a.target.offsetTop},a.onDrag=function(a){var d=a.target,e=a.gesture.deltaX,f=a.gesture.deltaY;d.style.left=b+e+"px",d.style.top=c+f+"px"}}]),angular.module("fullstackApp").config(["$stateProvider",function(a){a.state("tabs.tabs-world",{url:"/world/:itemId",views:{"tabs-world":{templateUrl:"app/item/item.html",controller:"ItemCtrl"}}})}]),angular.module("fullstackApp").factory("authHttp",["HOST","$http",function(a,b){var c={};return angular.forEach(["get","delete","head","jsonp"],function(d){c[d]=function(c,e){return b[d](a+c,e)}}),angular.forEach(["post","put"],function(d){c[d]=function(c,e,f){return b[d](a+c,e,f)}}),c}]),angular.module("fullstackApp").factory("resources",["authHttp","HOST","$rootScope","$ionicLoading",function(a,b,c,d){var e={},f=2,g=!0;return e.banns=function(b){a.get("/api/things",{params:{limit:5}},{cache:!0}).success(function(a){return b(a)}).error(function(a,b){alert("错误 "+b)})},e.addBann=function(a){e.banns.push(a),c.$broadcast("banns.update")},e.worlds=function(b){a.get("/api/worlds",{params:{limit:10,page:1}},{cache:!0,timeout:2e4}).success(function(a){return b(a)}).error(function(a,b){alert("错误 "+b)})},e.addWorld=function(a){e.worlds.push(a),c.$broadcast("worlds.update")},e.hasNextPage=function(a){return"undefined"!=typeof a&&(g=a),g},e.refresh=function(b){a.get("/api/worlds",{params:{limit:10,page:1}},{cache:!0}).success(function(a){return f=2,b(a)}).error(function(a,b){alert("错误")})},e.loadMore=function(b){return a.get("/api/worlds",{params:{limit:10,page:f}},{cache:!0}).success(function(a){return a.length<10?(g=!1,d.show({template:"木有了亲！",noBackdrop:!0,duration:2e3})):g=!0,f++,b(a)})},e}]).factory("my",["$http","$q",function(a,b){var c={};return c.banns=function(){var c=b.defer();return a({method:"GET",url:"/api/things",params:{},cache:!0,timeout:3e3}).success(function(a,b,d,e){c.resolve(a)}).error(function(a,b,d,e){c.reject(a)}),c.promise},c}]),angular.module("fullstackApp").controller("StopwatchCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("fullstackApp").config(["$stateProvider",function(a){a.state("tabs.stopwatch",{url:"/stopwatch",views:{"tabs-stopwatch":{templateUrl:"app/stopwatch/stopwatch.html",controller:"StopwatchCtrl"}}})}]),angular.module("fullstackApp").controller("TimerCtrl",["$scope","$ionicFilterBar",function(a,b){b.show({cancelText:"取消",update:function(a,b){}})}]),angular.module("fullstackApp").config(["$stateProvider",function(a){a.state("tabs.timer",{url:"/timer",views:{"tabs-timer":{templateUrl:"app/timer/timer.html",controller:"TimerCtrl"}}})}]),angular.module("fullstackApp").controller("WorldCtrl",["$scope","$rootScope","$ionicScrollDelegate","$timeout","$ionicModal","$ionicLoading","$ionicSlideBoxDelegate","authHttp","$location","resources","my",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){var b,c=new Date(a),d=new Date,e=c.getFullYear(),f=c.getMonth()+10,g=c.getDate(),h=c.getHours(),i=c.getMinutes(),j=d.getFullYear(),k=d.getHours();if(j>e)b=e+"年"+f+"月"+g+"日 "+h+":"+i;else{var l=d-c,m=l/36e5;if(m>k)b=f+"月"+g+"日 "+h+":"+i;else if(m>=1)b="今天 "+h+":"+i+"分";else{var n=d.getMinutes()-i;b=n>1?n+"分钟前":"刚刚"}}return b}a.data={showDelete:!1,showReorder:!1},f.show({noBackdrop:!0,hideOnStateChange:!0}),a.$on("banns.update",function(){j.banns(function(b){a.banns=b}),a.$apply()}),k.banns().then(function(b){a.banns=b},function(a){alert(a)}),j.worlds(function(b){angular.forEach(b,function(a,c){b[c].time=l(a.time)}),a.items=b,d(function(){f.hide()},500)}),a.$on("worlds.update",function(){j.worlds(function(b){angular.forEach(b,function(a,c){b[c].time=l(a.time)}),a.items=b})}),a.hasNextPage=j.hasNextPage(),a.loadError=!1,a.edit="编辑",a.toggleHtml=function(){"编辑"==a.edit?a.edit="完成":a.edit="编辑"},a.moveItem=function(b,c,d){a.items.splice(c,1),a.items.splice(d,0,b)},a.onItemDelete=function(a){h.get("/api/world-modals",{params:{_id:a._id}}).success(function(a){a&&b.$broadcast("worlds.update")}).error(function(a){console.log(a)})},a.doRefresh=function(){j.refresh(function(b){angular.forEach(b,function(a,c){b[c].time=l(a.time)}),a.items=b,a.hasNextPage=!0,a.loadError=!1,a.$broadcast("scroll.refreshComplete")})},a.loadMore=function(){j.loadMore(function(b){a.hasNextPage=!1,a.loadError=!1,d(function(){a.hasNextPage=j.hasNextPage()},100),angular.forEach(b,function(a,c){b[c].time=l(a.time)}),a.items=a.items.concat(b),a.$broadcast("scroll.infiniteScrollComplete")})},e.fromTemplateUrl("components/modal/modal.html",{scope:a,animate:"slide-in-up"}).then(function(b){function d(){for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ#",b=new Array,c=0;c<a.length;c++){var d=a.charAt(c);b.push(d)}return b}a.modal=b;var e=[{first_name:"Francis",last_name:"Hill"},{first_name:"Lessie",last_name:"Caldwell"},{first_name:"Alyson",last_name:"Woodward"},{first_name:"Malone",last_name:"Becker"},{first_name:"Terrell",last_name:"Stein"},{first_name:"Laurie",last_name:"Ayers"},{first_name:"Rowland",last_name:"Rosario"},{first_name:"Laurel",last_name:"Hobbs"},{first_name:"Kristie",last_name:"Barker"},{first_name:"Riley",last_name:"Ortiz"},{first_name:"Morin",last_name:"Terry"},{first_name:"Ida",last_name:"Haney"},{first_name:"Boyd",last_name:"Davis"},{first_name:"Milagros",last_name:"Blair"},{first_name:"Marissa",last_name:"Howell"},{first_name:"Whitehead",last_name:"Sosa"},{first_name:"Potts",last_name:"Byers"},{first_name:"Tara",last_name:"Adams"},{first_name:"Velasquez",last_name:"Carver"},{first_name:"Dale",last_name:"Flowers"},{first_name:"Baldwin",last_name:"Donovan"},{first_name:"Lynch",last_name:"Gibson"},{first_name:"Deana",last_name:"Norris"},{first_name:"Harrison",last_name:"Decker"},{first_name:"Anne",last_name:"Harris"},{first_name:"Nanette",last_name:"Harmon"},{first_name:"Byers",last_name:"Maldonado"}],f={};for(h=0;h<e.length;h++){var g=e[h].first_name.toUpperCase().charAt(0);void 0===f[g]&&(f[g]=[]),f[g].push(e[h])}a.sorted_users=angular.fromJson(f),a.alphabet=d(),a.gotoList=function(a){i.hash(a),c.$getByHandle("modalScroll").anchorScroll(!0)},a.groups=[];for(var h=0;10>h;h++){a.groups[h]={name:h,items:[]};for(var j=0;3>j;j++)a.groups[h].items.push(h+"-"+j)}}),a.openModal=function(){a.modal.show()},a.closeModal=function(){a.modal.hide()},a.removeModal=function(){a.modal.remove()},a.$on("$destroy",function(){a.modal.remove()}),a.scrollFixed=function(){i.url("/")},Date.prototype.format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)new RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));return a},a.pushData=function(c){a.closeModal(),h.post("/api/world-modals",{params:{city:c.first_name+"-"+c.last_name,time:(new Date).format("yyyy-MM-dd hh:mm:ss")}}).success(function(a){a&&b.$broadcast("worlds.update")}).error(function(a){console.log(a)})},a.pager=function(a){g.slide(a)}}]),angular.module("fullstackApp").config(["$stateProvider",function(a){a.state("tabs.world",{url:"/",views:{"tabs-world":{templateUrl:"app/world/world.html",controller:"WorldCtrl"}}})}]),angular.module("fullstackApp").controller("TabsCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("fullstackApp").config(["$stateProvider",function(a){a.state("tabs",{url:"","abstract":!0,templateUrl:"components/tabs/tabs.html",controller:"TabsCtrl"})}]),angular.module("fullstackApp").run(["$templateCache",function(a){a.put("app/alarm/alarm.html",'<ion-view hide-nav-bar=true view-title=个人中心 class=stable-bg><ion-header-bar align-title=center class=bar-assertive><a class="button button-icon ion-ios-search" href=/search></a><h1 class=title>百草味</h1><a class="button button-icon ion-ios-search" href=/search></a></ion-header-bar><ion-content></ion-content></ion-view>'),a.put("app/item/item.html",'<ion-view hide-nav-bar=true can-swipe-back=true view-title=item class=table-bg hide-tabs><ion-header-bar class=bar-stable><button class="button icon-left button-clear ion-ios-arrow-left" ng-click=$ionicGoBack()>返回</button><h1 class=title>item</h1><button class="button button-clear">哈哈</button></ion-header-bar><ion-content><img src=../../assets/images/ae2f125a.2.jpg on-touch=onTouch($event) on-drag=onDrag($event); class=disable-user-behavior style="width: 100px; position: absolute; height: 100px; z-index: 4"></ion-content></ion-view>'),a.put("app/stopwatch/stopwatch.html",'<ion-view hide-nav-bar=true view-title=个人中心 class=stable-bg><ion-header-bar class=bar-table><a class="button button-icon ion-ios-search" href=/search></a><h1 class=title>秒表</h1></ion-header-bar><ion-content></ion-content></ion-view>'),a.put("app/timer/timer.html",'<ion-view hide-nav-bar=true view-title=个人中心 class=stable-bg><ion-header-bar class=bar-table><a class="button button-icon ion-ios-search" href=/search></a><h1 class=title>个人中心</h1></ion-header-bar><ion-content></ion-content></ion-view>'),a.put("app/world/world.html",'<ion-view hide-nav-bar=true view-title=世界时钟 class=stable-bg><ion-header-bar class=bar-stable><button class="button button-clear button-assertive" ng-click="data.showDelete = !data.showDelete; data.showReorder = !data.showReorder; toggleHtml();" ng-bind=edit></button><h1 class=title>世界时钟</h1><button class="button button-clear button-icon button-assertive ion-ios-plus-empty" ng-click=openModal()></button></ion-header-bar><ion-content delegate-handle=mainScroll><ion-slide-box does-continue=true auto-play=true show-pager=true slide-interval=3500 pager-click=pager(index)><ion-slide ng-repeat="bann in banns"><a href={{bann.rout}} title=""><img src={{bann.img_rout}}></a></ion-slide></ion-slide-box><ion-refresher ng-if="items.length > 0" on-refresh=doRefresh() pulling-text=下拉刷新 pulling-icon=ion-arrow-down-c spinner=ios-small></ion-refresher><ion-list show-delete=data.showDelete show-reorder=data.showReorder class=avatar-img-middle><ion-item ng-repeat="item in items" item=item class=item-avatar-right href=/world/{{item._id}}><img ng-src={{item.img_rout}} err-src=../../assets/images/e22e0f59.3.jpg><h2 ng-bind-template={{item.city}}></h2><p ng-bind-template={{item.time}}></p><ion-delete-button class=ion-minus-circled add-animates ng-click=onItemDelete(item)></ion-delete-button><ion-option-button class=button-assertive add-animates ng-click=onItemDelete(item)>删除</ion-option-button><ion-reorder-button class=ion-navicon on-reorder="moveItem(item, $fromIndex, $toIndex)"></ion-reorder-button></ion-item></ion-list><ion-infinite-scroll on-infinite=loadMore() ng-if="hasNextPage && !loadError" spinner=ios-small distance=1%></ion-infinite-scroll></ion-content><ion-scroller-top animate=true css-class="button button-clear button-stable icon ion-ios-arrow-thin-up go-top" text=顶部 offset=300></ion-scroller-top></ion-view>'),a.put("components/modal/modal.html",'<ion-modal-view><ion-header-bar class="bar-table item-input-inset T-top-bar" no-tap-scroll=true><div class="button button-clear button-dark" style=font-size:12px>选取城市</div><label class="item-input-wrapper content" m-clear><i class="icon ion-ios-search-strong placeholder-icon"></i> <input type=text placeholder="" ng-model=searchText.first_name><clear-icon></clear-icon></label><a class="button button-clear button-assertive" ng-click=closeModal()>取消</a></ion-header-bar><ion-content padding=false scroll=true delegate-handle=modalScroll on-scroll=scrollFixed()><div ng-repeat="(letter, authors) in sorted_users" class="alpha_list list-inset-left list"><ion-item class="item item-divider" id={{letter}} auto-divider>{{letter}}</ion-item><ion-item ng-repeat="author in authors | filter:searchText" ng-click=pushData(author)>{{author.first_name}} {{author.last_name}}</ion-item></div></ion-content><div class=alpha_sidebar><a ng-repeat="letter in alphabet" ng-click=gotoList(letter)>{{letter}}</a></div></ion-modal-view>'),a.put("components/tabs/tabs.html",'<ion-tabs class="tabs-icon-top tabs-color-active-assertive tabs-light" ng-class="{\'tabs-item-hide\': hideTabs}"><ion-tab title=世界时钟 icon-off=ion-ios-world-outline icon-on=ion-ios-world href="/"><ion-nav-view name=tabs-world></ion-nav-view></ion-tab><ion-tab title=闹钟 icon-off=ion-ios-alarm-outline icon-on=ion-ios-alarm href=/alarm><ion-nav-view name=tabs-alarm></ion-nav-view></ion-tab><ion-tab title=秒表 icon-off=ion-ios-stopwatch-outline icon-on=ion-ios-stopwatch badge=1 badge-style=badge-assertive href=/stopwatch><ion-nav-view name=tabs-stopwatch></ion-nav-view></ion-tab><ion-tab title=计时器 icon-off=ion-ios-timer-outline icon-on=ion-ios-timer href=/timer><ion-nav-view name=tabs-timer></ion-nav-view></ion-tab></ion-tabs>')}]);